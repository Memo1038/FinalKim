<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DosiThink</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    h1, h2 {
      text-align: center;
      color: #0D47A1;
    }
    input, select, button {
      width: 100%;
      max-width: 400px;
      margin: 10px auto;
      display: block;
      padding: 12px;
      font-size: 1em;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    .hidden {
      display: none;
    }
    .med-item {
      background: white;
      border: 1px solid #ccc;
      padding: 15px;
      margin: 10px 0;
      border-radius: 5px;
    }
    iframe {
      display: block;
      margin: auto;
      width: 100%;
      max-width: 700px;
      height: 520px;
      border: none;
    }
  </style>
</head>
<body>

  <h1>DosiThink</h1>
  <h2>Because Every Dose Matters</h2>

  <!-- Google Form embedded -->
  <div id="form-section">
    <iframe id="googleForm" src="https://docs.google.com/forms/d/e/1FAIpQLSc8jDPYWLYRoYcCB4JHJ-i1kVBc75Q2nkdDkKQ7oGII_pYxiA/viewform?embedded=true" frameborder="0" marginheight="0" marginwidth="0">Loading…</iframe>
  </div>

  <!-- Medication section appears after form submission -->
  <div id="medication-section" class="hidden">
    <h2 id="welcome-name">Welcome</h2>
    <form id="med-form">
      <input type="text" id="med-name" placeholder="Drug Name" required />
      <input type="text" id="med-dose" placeholder="Dose" required />
      <input type="text" id="med-used" placeholder="Drug Used For / دواء علاج" required />
      <input type="time" id="med-time" required />
      <select id="med-repeat">
        <option value="daily">Daily</option>
        <option value="weekly">Weekly</option>
      </select>
      <button type="submit">Add Medication</button>
    </form>
    <div id="medication-list"></div>
  </div>

  <script>
    let meds = [];

    // Detect when the Google Form is submitted (basic workaround using time delay)
    const formSection = document.getElementById('form-section');
    const medSection = document.getElementById('medication-section');

    // Set a delay to allow form submission before showing medication screen
    window.addEventListener('message', function(e) {
      if (e.origin.includes("google.com")) {
        console.log("Message received from Google iframe:", e.data);
      }
    });

    // Watch for when user scrolls down or waits a while (simulate form submission)
    setTimeout(() => {
      const proceed = confirm("Did you finish the form?");
      if (proceed) {
        formSection.classList.add('hidden');
        medSection.classList.remove('hidden');
        document.getElementById("welcome-name").innerText = `Welcome to DosiThink`;
      }
    }, 15000); // You can adjust the delay (ms)
    
    // Add medications
    document.getElementById("med-form").addEventListener("submit", function (e) {
      e.preventDefault();
      const name = document.getElementById("med-name").value;
      const dose = document.getElementById("med-dose").value;
      const used = document.getElementById("med-used").value;
      const time = document.getElementById("med-time").value;
      const repeat = document.getElementById("med-repeat").value;

      const today = new Date().toISOString().split("T")[0];
      const med = { name, dose, used, time, repeat, date: today, status: "⏳ Pending" };
      meds.push(med);
      renderMedications();
      document.getElementById("med-form").reset();
    });

    function renderMedications() {
      const list = document.getElementById("medication-list");
      list.innerHTML = "<h3>Today's Medications</h3>";
      meds.forEach((m) => {
        const div = document.createElement("div");
        div.className = "med-item";
        div.innerHTML = `
          <strong>${m.name}</strong><br>
          Dose: ${m.dose}<br>
          For: ${m.used}<br>
          Time: ${m.time}<br>
          Status: ${m.status}<br>
        `;
        list.appendChild(div);
      });
    }
  </script>
</body>
</html>
