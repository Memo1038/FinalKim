      <!-- This is dynamically generated by JavaScript -->
    </tbody>
  </table>

  <audio id="alarmSound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" preload="auto"></audio>

  <script>
    const patientName = "Ahmed"; // replace with dynamic name if needed
    const medicationList = [
      {
        name: "Plavix",
        dose: "75mg",
        indication: "Heart Protection",
        time: "09:00",
        repeat: "daily",
        startDate: new Date("2025-07-14")
      },
      {
        name: "Controloc",
        dose: "40mg",
        indication: "Stomach",
        time: "10:00",
        repeat: "weekly",
        startDate: new Date("2025-07-14")
      }
    ];

    const tableBody = document.querySelector("tbody");
    const alarm = document.getElementById("alarmSound");

    function formatDate(date) {
      return date.toISOString().split('T')[0];
    }

    function getDayName(date) {
      return date.toLocaleDateString('en-US', { weekday: 'long' });
    }

    function createRow(med, date) {
      const tr = document.createElement("tr");
      tr.dataset.date = formatDate(date);
      tr.dataset.time = med.time;
      tr.dataset.name = med.name;
      tr.dataset.status = "pending";

      tr.innerHTML = `
        <td>${getDayName(date)}</td>
        <td>${formatDate(date)}</td>
        <td>${med.time}</td>
        <td>${med.name}</td>
        <td>${med.dose}</td>
        <td>${med.indication}</td>
        <td class="status status-pending">‚è≥ Pending</td>
        <td>
          <button onclick="markTaken(this)">‚úÖ Taken</button>
          <button onclick="snooze(this)">‚è∞ Snooze</button>
        </td>
      `;
      tableBody.appendChild(tr);
    }

    function markTaken(btn) {
      const row = btn.closest("tr");
      row.querySelector(".status").innerHTML = "‚úÖ Taken";
      row.querySelector(".status").className = "status status-taken";
      row.dataset.status = "taken";
    }

    function snooze(btn) {
      const row = btn.closest("tr");
      row.querySelector(".status").innerHTML = "üïí Snoozed 10 min";
      row.querySelector(".status").className = "status status-pending";

      setTimeout(() => {
        if (row.dataset.status !== "taken") {
          row.querySelector(".status").innerHTML = "‚ùå Missed";
          row.querySelector(".status").className = "status status-missed";
          row.dataset.status = "missed";
          notifyFamily(row);
        }
      }, 10 * 60 * 1000);
    }

    function notifyFamily(row) {
      const drug = row.dataset.name;
      alert(`Family alert: Dose missed for ${drug}`);
    }

    function scheduleNotifications() {
      const now = new Date();
      const today = formatDate(now);

      document.querySelectorAll("tr").forEach(row => {
        const rowDate = row.dataset.date;
        const rowTime = row.dataset.time;
        const status = row.dataset.status;

        if (rowDate === today && status === "pending") {
          const [h, m] = rowTime.split(":");
          const doseTime = new Date();
          doseTime.setHours(h, m, 0, 0);

          const delay = doseTime - now;
          if (delay >= 0) {
            setTimeout(() => {
              const drug = row.dataset.name;
              const dose = row.children[4].innerText;
              const usedFor = row.children[5].innerText;

              // Show notification
              showNotification(drug, dose, usedFor);
              alarm.play();
            }, delay);
          }
        }
      });
    }

    function showNotification(drug, dose, indication) {
      if (Notification.permission === "granted") {
        new Notification(`Time to take ${drug}`, {
          body: `Dose: ${dose}\nUsed for: ${indication}`,
        });
      }
    }

    function generateTable() {
      const today = new Date();
      for (const med of medicationList) {
        for (let i = 0; i < 30; i++) {
          const date = new Date(med.startDate);
          if (med.repeat === "daily") {
            date.setDate(date.getDate() + i);
          } else if (med.repeat === "weekly") {
            date.setDate(date.getDate() + i * 7);
          }
          if (date >= today) {
            createRow(med, date);
          }
        }
      }
    }

    // Ask for permission and run
    if ("Notification" in window) {
      Notification.requestPermission().then(permission => {
        if (permission === "granted") {
          generateTable();
          scheduleNotifications();
        }
      });
    } else {
      alert("Notifications are not supported in this browser.");
    }
  </script>
</body>
</html>
